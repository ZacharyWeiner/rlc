<% Reservation.where(email: request.query_parameters[:q]).each do |res| %>
  <div class='row'>
    <div class='col-md-3'>
      <%= res.experience_occurance.experience.title %> <br>
      <%= res.experience_occurance.date %>
    </div>
    <div class='col-md-6'>
      Name: <%= res.name %> <br>
      Seats Requested: <%= res.count %> <br>
      Cost: <%= res.experience.cost %> per seat<br>
    </div>
    <div class='col-md-3'>
      <% if res.paid %>
        <p>Paid</p>
      <% else %>
        <%= form_tag charges_path do %>
          <article>
            <% if flash[:error].present? %>
              <div id="error_explanation">
                <p><%= flash[:error] %></p>
              </div>
            <% end %>
            <label class="amount">
              <% cost = (res.experience.cost * res.count) %>
              <span>Deposit: $<%= cost %></span>
            </label>
          </article>
          <%= hidden_field_tag :reservation_id, :value => res.id %>
          <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                  data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
                  data-description="A month's subscription"
                  data-amount="<%= (cost * 100)%>"
                  data-locale="auto"></script>

        <% end %>
      <% end %>
    </div>
  </div>
<% end %>

